<section>
  <h3>Shopping Cart</h3>
  <% if @cart %>
  <table class="table">
    <thead>
      <tr>
        <th>Snack</th>
        <th>Quantity</th>
        <th>Item Total</th>
        <th>Remove from Cart</th>
      </tr>
    </thead>
    <tbody>
      <% @cart.order_items.each do |order_item| %>

      <tr>
        <td><%= link_to order_item.product.name, product_path(order_item.product.id) %></td>
        <td>
          <%= form_with model: order_item do |f| %>
          <%= f.label :quantity %>
          <!-- need an inventory column in products table -->
          <%= f.select :quantity, order_item.available_stock, {}, { value: order_item.quantity, onchange: 'this.form.submit();' }%>
          <% end %>
        </td>
        <td>
          <%= number_to_currency(order_item.item_total) %>
        </td>
        <td><%= link_to "Remove item", order_item_path(order_item), method: :delete, data: { confirm: "Are you sure you want to remove #{order_item.product.name} from the cart?" }, class: "btn btn-outline-danger" %>
        </td>
      </tr>
      <%end%>
      <tr>
        <td></td>
        <td> Subtotal</td>
        <td> <%= number_to_currency(@cart.subtotal) %></td>
        <td></td>
      </tr>
      <tr>
        <td></td>
        <td> Tax</td>
        <td> <%= Order.tax_rate %> %</td>
        <td></td>
      </tr>
      <tr>
        <td></td>
        <td> Total</td>
        <td> <%= number_to_currency(@cart.total) %> </td>
        <td></td>
      </tr>
    </tbody>
  </table>

<div>
  <%= link_to "Continue to checkout", edit_order_path(@order), method: :get %>
</div>


  <% else %>
  <p>
    No snacks for you!
  </p>

  <% end %>

</section>
