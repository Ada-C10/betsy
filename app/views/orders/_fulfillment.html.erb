<h2 class="order_heading"> <%= @current_user.name %>'s Fulfillment page </h2>
<div class="dropdown show order_types">
  <a class="btn btn-secondary dropdown-toggle" href="#" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Filter Orders
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
    <%= link_to "Paid", paid_orders_path, class: "dropdown-item" %>
    <%= link_to "Completed", completed_orders_path, class: "dropdown-item" %>
    <%= link_to "Cancelled", cancelled_orders_path, class: "dropdown-item" %>
    <%= link_to "All Orders", get_orders_path, class: "dropdown-item" %>
  </div>
</div>
<br>
<br>

<table class="table">
  <thead>
    <tr>
      <th scope="col"> Creature </th>
      <th scope="col"> Cost </th>
      <th scope="col"> Count </th>
      <th scope="col"> Paid </th>
      <th scope="col"> Order Date </th>
      <th scope="col"> Order # </th>
      <th scope="col"> Status </th>
    </tr>
  </thead>
    <tbody>
      <% @orders.each do |order| %>
          <% order.orderproducts.each do |orderproduct| %>
              <tr>
                <td>
                  <%= link_to orderproduct.product.name, product_path(orderproduct.product.id) %>
                </td>
                <td>
                  <%= money_display(orderproduct.product.price) %>
                </td>
                <td>
                  <%= orderproduct.quantity %>
                </td>
                <td>
                  <%= orderproduct.quantity * orderproduct.product.price %>
                </td>
                <td>
                  <%= readable_date(order.created_at) %>
                </td>
                <td>
                  <%= link_to "#{order.id}", order_path(order.id) %>
                </td>
                <td>
                  <%= form_with model: orderproduct do |f| %>
                    <%= f.label :status %>
                    <%= f.select :status, options_for_select(["pending", "shipped"], :selected => orderproduct.status) %>
                  <%= f.submit "Change Status", class: "btn btn-primary" %>
                  <% end %>
                </td>
              </tr>
              <% end %>
            <% end %>
          </tbody>
        </table>

<section class="orders_details">
  <h3> Orders count: <%= @orders.count %> </h3>
  <h3> Fundraising Revenue for all Orders: <%= money_display(@total_revenue) %> </h3>
</section>
