<h1 class="cart-heading-padding">Shopping Cart </h1>
<% total = 0 %>
<table class="table">
  <thead>
    <tr>
      <th scope="col"></th>
      <th scope="col">Name</th>
      <th scope="col">Price</th>
      <th scope="col">Total</th>
      <th scope="col">Quantity</th>
      <th scope="col">Remove from Cart</th>
    </tr>
  </thead>
  <tbody>
    <% @cart_items.each do |cart_array| %>
    <%
    product =  cart_array[0]
    quantity = cart_array[1]
    option_values = product.stock_count > 1 ? [*1..product.stock_count] : [product.stock_count]
    %>
    <tr>
      <td><%= image_tag product.photo_url, class: "cart-img"%></td>
      <td><%= link_to product.name.capitalize, product_path(product.id) %></td>
      <td>$<%= money_display(product.price)%></td>
      <% total += (quantity * product.price) %>
      <td>$<%= money_display(quantity * product.price) %> </td>
      <td>
        <%= form_with url: update_cart_path(product.id), method: :patch do |f| %>
        <%= f.select :quantity, options_for_select(option_values, :selected => quantity) %>
        <%= f.submit "Update", class: "btn btn-primary"%>
        <% end %>
      </td>
      <td><%= link_to "Remove from Cart", remove_from_cart_path(product.id), class: "btn btn-primary"%></td>
    </tr>
    <% end %>
  </tbody>
</table>
<% if total > 0 %>
<section>
  <h3>Cart Total: $<%= money_display(total) %></h3>
  <p><%= link_to "Checkout Cart", new_order_path, class: "btn btn-primary"%></p>
</section>
<% else %>
<section>
  <h3>Your cart is empty</h3>
</section>
<% end %>
